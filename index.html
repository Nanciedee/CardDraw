<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Card Draw</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0;
      padding: 20px;
      background: #f4f4f9;
      color: #333;
    }
    h1 {
      color: #444;
      margin-bottom: 20px;
    }
    .btn {
      padding: 15px 25px;
      font-size: 18px;
      margin: 10px;
      cursor: pointer;
      border-radius: 8px;
      border: none;
      background-color: #4CAF50;
      color: white;
      display: inline-block;
    }
    .btn:hover {
      background-color: #45a049;
    }
    #result {
      font-size: 22px;
      margin: 20px 0;
      font-weight: bold;
    }
    #status {
      margin-top: 10px;
      font-size: 14px;
      color: #666;
    }
    #history {
      margin-top: 30px;
      text-align: left;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    #history h2 {
      font-size: 18px;
      margin-bottom: 10px;
    }
    #history ul {
      list-style: none;
      padding: 0;
      max-height: 200px;
      overflow-y: auto;
    }
    #history li {
      padding: 5px 0;
      border-bottom: 1px solid #eee;
      font-size: 16px;
    }
    @media (max-width: 600px) {
      .btn {
        width: 90%;
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
  <h1>üé¥ Card Draw</h1>

  <button class="btn" onclick="drawCards()">Draw Cards</button>
  <button class="btn" onclick="manualShuffle()">üîÑ Shuffle Decks</button>
  <button class="btn" onclick="exportHistory()">üìÅ Export History</button>

  <p id="result"></p>
  <p id="status"></p>

  <div id="history">
    <h2>üìú History of Draws</h2>
    <ul id="historyList"></ul>
  </div>

  <script>
    // Full decks
    const fullArcDeck = [
      "Arc of Fire", "Arc of Water", "Arc of Earth", "Arc of Air",
      "Arc of Spirit", "Arc of Shadow", "Arc of Light", "Arc of Time",
      "Arc of Wisdom", "Arc of Strength", "Arc of Healing", "Arc of Fate"
    ];

    const fullVibDeck = [
      "Vib of Joy", "Vib of Peace", "Vib of Energy",
      "Vib of Balance", "Vib of Love"
    ];

    // Working decks
    let arcDeck = [...fullArcDeck];
    let vibDeck = [...fullVibDeck];

    // History
    let history = [];

    function drawCards() {
      if (arcDeck.length === 0) {
        arcDeck = [...fullArcDeck];
        alert("üîÑ Arc deck reshuffled!");
      }
      if (vibDeck.length === 0) {
        vibDeck = [...fullVibDeck];
        alert("üîÑ Vib deck reshuffled!");
      }

      // Pick and remove Arc
      const arcIndex = Math.floor(Math.random() * arcDeck.length);
      const arc = arcDeck.splice(arcIndex, 1)[0];

      // Pick and remove Vib
      const vibIndex = Math.floor(Math.random() * vibDeck.length);
      const vib = vibDeck.splice(vibIndex, 1)[0];

      // Save to history
      const pair = `Arc: ${arc} | Vib: ${vib}`;
      history.push(pair);

      // Show result
      document.getElementById("result").innerText = pair;

      // Show how many left
      document.getElementById("status").innerText =
        `Remaining ‚Üí Arc: ${arcDeck.length} | Vib: ${vibDeck.length}`;

      // Update history list
      updateHistory();
    }

    function manualShuffle() {
      arcDeck = [...fullArcDeck];
      vibDeck = [...fullVibDeck];
      alert("üîÑ Both decks reshuffled!");
      document.getElementById("status").innerText =
        `Remaining ‚Üí Arc: ${arcDeck.length} | Vib: ${vibDeck.length}`;
    }

    function updateHistory() {
      const list = document.getElementById("historyList");
      list.innerHTML = "";
      history.slice().reverse().forEach(draw => {
        const li = document.createElement("li");
        li.textContent = draw;
        list.appendChild(li);
      });
    }

    function exportHistory() {
      if (history.length === 0) {
        alert("No draws to export yet!");
        return;
      }

      let csvContent = "data:text/csv;charset=utf-8,Draws\n";
      history.forEach(row => {
        csvContent += row + "\n";
      });

      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", "card_draw_history.csv");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
  </script>
</body>
</html>
